rule moudoor_dropper {
	meta:
		copyright = "Symantec Corporation"

	strings:
		$a = "vptray.exe\x00"
		$b = /cmd.exe \/c ping localhost -n . & del \"%s\"\x00/
		$c1 = "up.bak\x00"
		$c2 = "auto.dat\x00"
		$d = /Symantec.{0,4}Update\x00/

		/*
		0FBE11                       movsx       edx,b,[ecx]
		83F219                       xor         edx,019
		8B45FC                       mov         eax,[ebp][-4]
		0345F8                       add         eax,[ebp][-8]
		8810                         mov         [eax],dl
		*/
		$e1 = {
		0FBE11
		83F2??
		8B45??
		0345??
		8810
		}

		/*
		8A1C01                       mov         bl,[ecx][eax]
		80F319                       xor         bl,019
		881C01                       mov         [ecx][eax],bl
		*/
		$e2 = {
		8A1C01
		80F3??
		881C01
		}

		/*
		80340119                     xor         b,[ecx][eax],019
		41                           inc         ecx
		3BCA                         cmp         ecx,edx
		*/
		$e3 = {
		803401??
		41
		3BCA
		}
		$f = /\x00esourceA[\x00]{1,5}FindR\x00/
	condition:
		4 of them
}

rule moudoor {
	meta:
		copyright = "Symantec Corporation"

	strings:
		$a = "%s%s:%d%s\x00"
		$b = "\x00killme\x00"
		$c = "connected: %s:%d\x00"
		$d = "Global\\X %d" wide
		$e = "360tray.exe\x00" wide
		$f = "delloader\x00"
		$g = "%-24s %-15s 0x%x(%d)" wide
	condition:
		4 of them
}

rule moudoor_downloader {
	meta:
		copyright = "Symantec Corporation"

	strings:
		$a = /GetCompu\x00.{5,14}\x00terNameA\x00/
		$b = /GetVe\x00.{5,14}\x00rsionExA\x00/
		$c = /URLDow\x00.{5,14}\x00nloadToFileA\x00/
		$d = /GetTemp\x00.{5,14}\x00PathA\x00/
		$e = /Creat\x00.{5,14}\x00eMutexA\x00/
		$f = /WinE\x00.{5,14}\x00xec\x00/
	condition:
		3 of them
}